#!/usr/bin/env bash

#Install nginx
sudo apt-get update -y
sudo apt-get install nginx -y

#check if nginx is running
sudo systemctl status nginx

# Verify nginx installation
if ! dpkg -l | grep -q nginx; then
    echo "Failed to install nginx."
    exit 1
fi

# Configure nginx to listen on port 80
sed -i 's/listen\s*80;/listen 80;/g' /etc/nginx/sites-available/default

# Restart nginx
service nginx restart > /dev/null 2>&1 || /etc/init.d/nginx restart > /dev/null 2>&1

# Verify nginx is running
if ! pgrep -x nginx > /dev/null; then
    echo "Failed to start nginx."
    exit 1
fi

# Create index.html file with Hello World
echo "Hello World!" > /usr/share/nginx/html/index.html

# Verify nginx root page contains "Hello World!" string
if ! curl -s localhost | grep -q "Hello World!"; then
    echo "Failed to verify nginx root page."
    exit 1
fi

echo "Nginx installed and configured successfully."
